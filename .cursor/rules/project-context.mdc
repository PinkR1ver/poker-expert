---
description: "Project background, goals, current status, and key concepts"
alwaysApply: false
---

# Project Context

## é¡¹ç›®æ¦‚è¿°

**Poker Expert** æ˜¯ä¸€ä¸ªåŸºäº Python å’Œ PySide6 å¼€å‘çš„å¾·å·æ‰‘å…‹æ‰‹ç‰Œè¿½è¸ªä¸åˆ†æè½¯ä»¶ï¼Œä¸“é—¨ç”¨äºè§£æå’Œåˆ†æ GGPoker å¹³å°çš„æ‰‹ç‰Œå†å²è®°å½•ã€‚

## é¡¹ç›®ç›®æ ‡

1. **æ•°æ®å¯¼å…¥ä¸å­˜å‚¨**ï¼šè§£æ GGPoker æ‰‹ç‰Œå†å²æ–‡ä»¶ï¼ˆ.txtï¼‰ï¼Œæå–å…³é”®ä¿¡æ¯å¹¶å­˜å‚¨åˆ° SQLite æ•°æ®åº“
2. **æ•°æ®å¯è§†åŒ–**ï¼šæä¾›ç›ˆäºæ›²çº¿ã€å¤šæ¡ EV / Showdown / Non-Showdown æ›²çº¿
3. **GTO åˆ†æ**ï¼šPreflop Range æŸ¥è¡¨ + Postflop Solver

## å½“å‰çŠ¶æ€

### å·²å®ŒæˆåŠŸèƒ½
- âœ… GGPoker æ‰‹ç‰Œå†å²æ–‡ä»¶è§£æ
- âœ… SQLite æ•°æ®åº“å­˜å‚¨ä¸ç®¡ç†
- âœ… Dashboard é¡µé¢ï¼šå¤šæ›²çº¿å›¾è¡¨
- âœ… Sessions é¡µé¢ï¼šSession ç»Ÿè®¡ + æ‰‹ç‰Œè¯¦æƒ… + åŒå‡» Replay
- âœ… Import é¡µé¢ï¼šæ–‡ä»¶å¯¼å…¥ï¼Œé‡å¤æ£€æµ‹
- âœ… Report é¡µé¢ï¼šPosition Analysis æŠ¥å‘Š
- âœ… Replay é¡µé¢ï¼šæ‰‹ç‰Œå›æ”¾åŠŸèƒ½
- âœ… **Preflop Range é¡µé¢**ï¼šGTO Range æŸ¥è¡¨ï¼ˆ50bb/100bb/200bbï¼‰
- âœ… **Leak Analyze é¡µé¢**ï¼šPreflop Range Check
- âœ… **Postflop Solver é¡µé¢**ï¼š
  - å¤šæ­¥éª¤å‘å¯¼ï¼šRange â†’ Settings â†’ Solve â†’ Results
  - å®Œæ•´å¤šè¡— Solverï¼ˆFlop â†’ Turn â†’ Riverï¼‰
  - Discounted CFR ç®—æ³•ï¼ˆæ‰‹ç‰Œçº§åˆ«ç­–ç•¥ï¼‰
  - Card Abstractionï¼ˆæŒ‰ rank åˆ†ç±»ï¼Œæœ€å¤š 13 ä¸ª bucketï¼‰
  - Effective Stack é™åˆ¶ï¼ˆè€ƒè™‘åŒæ–¹ç­¹ç é™åˆ¶ bet/raise å°ºåº¦ï¼‰
  - All-in é€‰é¡¹æ”¯æŒ
  - Game Tree å¯¼èˆª + Range è¿‡æ»¤
  - Board Blocker æ£€æµ‹ï¼ˆrange æ˜¾ç¤ºè€ƒè™‘å…¬å…±ç‰Œé˜»æŒ¡ï¼‰
  - Combo çº§åˆ« Equity æ˜¾ç¤ºï¼ˆæ¯ä¸ªèŠ±è‰²ç»„åˆç‹¬ç«‹è®¡ç®—ï¼‰
  - Equity/Convergence çœŸå®å†å²å›¾è¡¨
  - å¹¶è¡Œè®¡ç®—é€‰é¡¹

### Solver å½“å‰é…ç½®

| å‚æ•° | å½“å‰å€¼ | è¯´æ˜ |
|------|--------|------|
| Card Abstraction | æŒ‰ rank åˆ†ç±» | æœ€å¤š 13 ä¸ª bucket |
| Max Raises | 2/è¡— | ç”¨æˆ·å¯é…ç½® |
| CFR é‡‡æ · | åŠ¨æ€ 5-12 combos | æ—©æœŸå¤šæ¢ç´¢ï¼ŒåæœŸåŠ é€Ÿ |
| Equity é‡‡æ · | 4 å¯¹æ‰‹ï¼Œ2 æ¨¡æ‹Ÿ | é€Ÿåº¦ä¼˜å…ˆ |
| Effective Stack | âœ… å·²å®ç° | é™åˆ¶ bet/raise å°ºåº¦ |
| All-in é€‰é¡¹ | âœ… å·²å®ç° | ç­¹ç ä¸è¶³æ—¶è‡ªåŠ¨æ·»åŠ  |

## ğŸš€ C++ Solver åŠ é€Ÿ

### å·²å®Œæˆ
- âœ… **Phase 1**: C++ Hand Evaluator + Equity Calculator
  - æ‰‹ç‰Œè¯„ä¼°ï¼ˆ5 å¼ ç‰Œ â†’ 7 å¼ ç‰Œæœ€ä½³ç»„åˆï¼‰
  - Monte Carlo equity è®¡ç®—
  - pybind11 ç»‘å®šï¼Œè‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨
  - **æ€§èƒ½æå‡: 20x**

- âœ… **Phase 2**: C++ CFR Engine
  - å®Œæ•´çš„ DCFR ç®—æ³•å®ç°ï¼ˆæ”¯æŒ Gamma è¡°å‡ç­–ç•¥æ›´æ–°ï¼‰
  - Game Tree æ‰å¹³åŒ–è¡¨ç¤ºï¼ŒåŸºäº **MmapBuffer** çš„ç£ç›˜æ˜ å°„å­˜å‚¨
  - **Perfect Deduplication**: ä½¿ç”¨çŠ¶æ€å“ˆå¸Œè¿›è¡Œåšå¼ˆæ ‘èŠ‚ç‚¹å»é‡
  - Python Wrapperï¼ˆ`solver/bridge/cpp_cfr_wrapper.py`ï¼‰æä¾› lazy-loading ä»£ç†ï¼ˆNodeProxyï¼‰
  - ä¸ Python ç‰ˆæœ¬ API å…¼å®¹

- âœ… **Phase 3**: æ€§èƒ½ä¸è§„æ¨¡ä¼˜åŒ–
  - ç£ç›˜æ˜ å°„æ”¯æŒåƒä¸‡çº§èŠ‚ç‚¹ï¼Œçªç ´å†…å­˜é™åˆ¶
  - ç­–ç•¥è®¡ç®—æé€Ÿ 10x+ï¼Œæ”¯æŒ Flop/Turn/River å…¨åœºæ™¯
  - æ”¹è¿›çš„ Betting é€»è¾‘ï¼Œæ”¯æŒ Separate Bet/Raise Sizing
  - æ”¯æŒ River All-in é¢å¯¹ä¸‹æ³¨çš„æ­£ç¡®å“åº”é€»è¾‘

### æ€§èƒ½å¯¹æ¯”

| æ“ä½œ | Python | C++ | åŠ é€Ÿæ¯” |
|------|--------|-----|--------|
| Equity (50k sims) | ~3000ms | ~150ms | **20x** |
| Hand Evaluation | ~0.1ms | ~0.005ms | **20x** |
| CFR (30 iters, Turn) | 5.73s | 0.45s | **12.7x** |
| Tree Building (Large) | 120s+ (OOM risk) | < 2s | **60x+** |

### OpenMP å¤šçº¿ç¨‹æ”¯æŒ
- âœ… å·²å¯ç”¨ï¼ˆ10 çº¿ç¨‹ï¼‰
- éœ€è¦å®‰è£… `brew install libomp`

### å¾…å®Œæˆ
- â³ **Phase 4**: Equity ç¼“å­˜ä¼˜åŒ–ï¼ˆé¢„æœŸ 2-5x é¢å¤–æå‡ï¼‰

### C++ æ¨¡å—ç»“æ„
```
solver/native/
â”œâ”€â”€ CMakeLists.txt          # CMake æ„å»ºé…ç½®
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ types.h             # æ ¸å¿ƒæ•°æ®ç»“æ„ï¼ˆCardInt, HandRankï¼‰
â”‚   â”œâ”€â”€ hand_evaluator.h    # è¯„ä¼°å™¨æ¥å£
â”‚   â”œâ”€â”€ cfr_types.h         # CFR æ•°æ®ç»“æ„
â”‚   â””â”€â”€ cfr_engine.h        # CFR Engine æ¥å£
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ hand_evaluator.cpp  # âœ… æ‰‹ç‰Œè¯„ä¼°
â”‚   â””â”€â”€ cfr_engine.cpp      # âœ… CFR ç®—æ³•
â””â”€â”€ bindings.cpp            # pybind11 ç»‘å®š
```

### ç¼–è¯‘å‘½ä»¤
```bash
cd solver/native
mkdir build && cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
make -j4
cp poker_solver_cpp.cpython-*.so ../..
```

## æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Python 3.12 (GUI) + C++17 (Solver æ ¸å¿ƒ)
- **GUI æ¡†æ¶**: PySide6 (Qt for Python)
- **æ•°æ®åº“**: SQLite3
- **æ•°æ®å¯è§†åŒ–**: Matplotlib
- **ç¯å¢ƒç®¡ç†**: Conda
- **C++ å·¥å…·é“¾**: CMake + pybind11 + Apple Clang 16

## é¡¹ç›®ç»“æ„ (Vibe Coding Structure)

```
poker-expert/
â”œâ”€â”€ core/                   # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ database/           # æ•°æ®åº“ç®¡ç†
â”‚   â”œâ”€â”€ engine/             # æ ¸å¿ƒå¼•æ“ (EquityCalc)
â”‚   â””â”€â”€ parser/             # æ‰‹ç‰Œè§£æ
â”œâ”€â”€ solver/                 # è§£ç®—å™¨é€»è¾‘
â”‚   â”œâ”€â”€ core/               # ç®—æ³•æ ¸å¿ƒ (CFR, GameTree)
â”‚   â”œâ”€â”€ native/             # C++ æºç 
â”‚   â””â”€â”€ bridge/             # Python/C++ æ¡¥æ¥
â”œâ”€â”€ ui/                     # ç•Œé¢å±•ç¤ºå±‚
â”‚   â”œâ”€â”€ pages/              # é¡µé¢æ¨¡å—
â”‚   â”œâ”€â”€ widgets/            # è‡ªå®šä¹‰ç»„ä»¶
â”‚   â””â”€â”€ styles/             # å…¨å±€æ ·å¼
â”œâ”€â”€ assets/                 # é™æ€èµ„æº
â”œâ”€â”€ scripts/                # æ„å»ºä¸ç»´æŠ¤è„šæœ¬
â”œâ”€â”€ tests/                  # æµ‹è¯•ç”¨ä¾‹
â””â”€â”€ main.py                 # åº”ç”¨å¯åŠ¨å…¥å£
```

## å…³é”®æ¦‚å¿µ

- **Hero**: ç©å®¶è‡ªå·±
- **GTO**: Game Theory Optimalï¼Œåšå¼ˆè®ºæœ€ä¼˜ç­–ç•¥
- **CFR**: Counterfactual Regret Minimizationï¼Œåäº‹å®åæ‚”æœ€å°åŒ–ç®—æ³•
- **Effective Stack**: åŒæ–¹ä¸­è¾ƒå°çš„ç­¹ç ï¼Œå†³å®šæœ€å¤§å¯èƒ½çš„è¡ŒåŠ¨
- **Card Abstraction**: å°†ç›¸ä¼¼çš„ç‰Œå½’ç±»ä»¥å‡å°‘è®¡ç®—é‡
- **bb/100**: æ¯ç™¾æ‰‹å¤§ç›²ç›ˆåˆ©
- **OOP/IP**: Out of Position / In Position
