---
description: "Development rules, environment management, code standards, and documentation maintenance requirements"
alwaysApply: true
---

# Development Rules

## ç¯å¢ƒç®¡ç†

### 1. è™šæ‹Ÿç¯å¢ƒè§„åˆ™
- **ç¦æ­¢ä½¿ç”¨ venv**ï¼šä¸è¦åˆ›å»º or ä½¿ç”¨ Python è™šæ‹Ÿç¯å¢ƒ (venv)
- **ä½¿ç”¨ Conda ç¯å¢ƒ**ï¼šé¡¹ç›®ä½¿ç”¨ `.conda` ç¯å¢ƒï¼Œé€šè¿‡ `conda activate` æ¿€æ´»
- **ä¾èµ–ç®¡ç†**ï¼šæ‰€æœ‰éœ€è¦çš„ Python åŒ…éƒ½å†™å…¥ `requirements.txt`ï¼Œç”¨æˆ·ä¼šè‡ªè¡Œä½¿ç”¨ `pip install -r requirements.txt` å®‰è£…

### 2. ä¾èµ–ç®¡ç†
- æ‰€æœ‰æ–°å¢çš„ Python åŒ…å¿…é¡»æ·»åŠ åˆ° `requirements.txt`
- ä¸è¦ä½¿ç”¨ `pip freeze` ç”Ÿæˆ requirementsï¼Œæ‰‹åŠ¨ç»´æŠ¤ä¾èµ–åˆ—è¡¨
- ä¿æŒä¾èµ–ç‰ˆæœ¬ç®€æ´ï¼Œé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå¦åˆ™ä¸æŒ‡å®šå…·ä½“ç‰ˆæœ¬å·

## ä»£ç è§„èŒƒ

### 1. æ–‡ä»¶ç»„ç»‡
- **`core/`**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ (parser, database, engine)
- **`solver/`**: è§£ç®—å™¨é€»è¾‘
  - `solver/core/`: ç®—æ³•æ ¸å¿ƒ (CFR, GameTree)
  - `solver/native/`: C++ æºç 
  - `solver/bridge/`: Python/C++ æ¡¥æ¥
- **`ui/`**: ç•Œé¢ç›¸å…³ä»£ç  (pages, widgets, styles)
- **`scripts/`**: æ„å»ºä¸ç»´æŠ¤è„šæœ¬

### 2. å‘½åè§„èŒƒ
- ç±»åä½¿ç”¨ `PascalCase`ï¼ˆå¦‚ `PokerHand`, `DBManager`ï¼‰
- å‡½æ•°å’Œå˜é‡ä½¿ç”¨ `snake_case`ï¼ˆå¦‚ `parse_hand`, `hero_name`ï¼‰
- å¸¸é‡ä½¿ç”¨ `UPPER_SNAKE_CASE`ï¼ˆå¦‚ `PROFIT_GREEN`, `DARK_THEME_QSS`ï¼‰

### 3. æ•°æ®åº“æ“ä½œ
- æ¯ä¸ªçº¿ç¨‹ä½¿ç”¨ç‹¬ç«‹çš„ `DBManager` å®ä¾‹ï¼ˆSQLite çº¿ç¨‹å®‰å…¨è¦æ±‚ï¼‰
- ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢ SQL æ³¨å…¥
- æ•°æ®åº“è¿ç§»é€šè¿‡ `ALTER TABLE` æˆ–è¡¨é‡å»ºå®ç°

## æ–‡æ¡£ç»´æŠ¤è§„åˆ™

### ğŸ“š é¡¹ç›®æ–‡æ¡£ç»“æ„

æœ¬é¡¹ç›®ä½¿ç”¨å››ä¸ªæ ¸å¿ƒè§„åˆ™æ–‡æ¡£ï¼ˆä½äº `.cursor/rules/` ç›®å½•ï¼‰ï¼š

- **`project-context.mdc`**: é¡¹ç›®èƒŒæ™¯ã€ç›®æ ‡ã€å½“å‰çŠ¶æ€
- **`dev-rules.mdc`**: å¼€å‘è§„åˆ™ã€ç¯å¢ƒç®¡ç†ã€ä»£ç è§„èŒƒï¼ˆæœ¬æ–‡æ¡£ï¼ŒalwaysApply: trueï¼‰
- **`architecture.mdc`**: ç³»ç»Ÿæ¶æ„ã€æ¨¡å—è®¾è®¡ã€æ•°æ®æµ
- **`glossary.mdc`**: æœ¯è¯­è¡¨ã€æ¦‚å¿µå®šä¹‰

**é‡è¦**: AI åŠ©æ‰‹åœ¨æ‰§è¡Œä»»åŠ¡å‰åº”æŸ¥é˜…ç›¸å…³æ–‡æ¡£ï¼Œç‰¹åˆ«æ˜¯ `project-context.mdc` å’Œ `architecture.mdc`ã€‚

### âš ï¸ é‡è¦ï¼šæ–‡æ¡£åŒæ­¥è¦æ±‚

- æ–‡æ¡£åªè®°å½•**å½“å‰å·²ç»å®ç°çš„æ¨¡å—å’ŒåŠŸèƒ½**ï¼Œä¸è¦åœ¨è§„åˆ™é‡Œå †ç§¯è¿˜æ²¡åšã€å·²ç»åºŸå¼ƒçš„æƒ³æ³•ã€‚
- æ¯æ¬¡å®Œæˆä¸€æ®µä»£ç æ”¹åŠ¨åï¼š
  1. å¦‚æœæ–°å¢/è°ƒæ•´äº†æ¨¡å—æˆ–ç±»ç»“æ„ â†’ æ›´æ–° `architecture.mdc` ä¸­å¯¹åº”éƒ¨åˆ†
  2. å¦‚æœæ–°å¢/è°ƒæ•´äº†å¯è§åŠŸèƒ½æˆ–é¡µé¢ â†’ åœ¨ `project-context.mdc` çš„"å·²å®ŒæˆåŠŸèƒ½"ä¸­è¡¥å……
  3. å¦‚æœæ–°å¢/è°ƒæ•´äº†å¼€å‘æµç¨‹æˆ–çº¦å®š â†’ æ›´æ–°æœ¬æ–‡ä»¶ `dev-rules.mdc`
  4. å¦‚æœå¼•å…¥äº†æ–°çš„ä¸“ä¸šæœ¯è¯­ â†’ åœ¨ `glossary.mdc` ä¸­è¡¥å……

### æ–‡æ¡£ä¼˜å…ˆçº§

å½“æ–‡æ¡£å†…å®¹ä¸ä»£ç ä¸ä¸€è‡´æ—¶ï¼š
- **ä»£ç ä¸ºå‡†**ï¼šæ–‡æ¡£éœ€è¦æ›´æ–°ä»¥åæ˜ å®é™…å®ç°
- **è®¾è®¡æ–‡æ¡£ä¸ºå‡†**ï¼šå¦‚æœæ˜¯æœ‰è®¡åˆ’çš„å˜æ›´ï¼Œå…ˆæ›´æ–°è®¾è®¡æ–‡æ¡£å†å®ç°

## Git å·¥ä½œæµ

- ä¸»åˆ†æ”¯ï¼š`main`
- åŠŸèƒ½å¼€å‘ï¼šåˆ›å»ºåŠŸèƒ½åˆ†æ”¯
- æäº¤ä¿¡æ¯ï¼šä½¿ç”¨æ¸…æ™°çš„ä¸­æ–‡æˆ–è‹±æ–‡æè¿°

## æµ‹è¯•è¦æ±‚

- å¯¼å…¥åŠŸèƒ½ï¼šæµ‹è¯•é‡å¤å¯¼å…¥æ£€æµ‹
- è§£æåŠŸèƒ½ï¼šæµ‹è¯•å„ç§è¾¹ç•Œæƒ…å†µï¼ˆç©ºæ–‡ä»¶ã€æ ¼å¼å¼‚å¸¸ç­‰ï¼‰
- GUI åŠŸèƒ½ï¼šç¡®ä¿å¤šçº¿ç¨‹æ“ä½œä¸é˜»å¡ç•Œé¢

## æ€§èƒ½è¦æ±‚

- æ–‡ä»¶å¯¼å…¥ä½¿ç”¨åå°çº¿ç¨‹ï¼ˆ`QThread`ï¼‰
- å¤§æ•°æ®é‡å›¾è¡¨æ¸²æŸ“ä½¿ç”¨é€‚å½“çš„æ•°æ®é‡‡æ ·
- æ•°æ®åº“æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–ï¼ˆhand_id ä¸ºä¸»é”®ï¼‰

## Solver æ¨¡å—è§„èŒƒ

### æ–‡ä»¶ç»„ç»‡
- Solver æ ¸å¿ƒé€»è¾‘æ”¾åœ¨ `solver/core/` ç›®å½•
- Solver UI æ”¾åœ¨ `ui/pages/solver/` ç›®å½•
- C++ å®ç°æ”¾åœ¨ `solver/native/` ç›®å½•

### æ€§èƒ½è°ƒä¼˜
- **Card Abstraction**ï¼šæŒ‰ rank åˆ†ç±»ï¼ˆæœ€å¤š 13 ä¸ª bucketï¼‰
- **Effective Stack**ï¼šbet/raise å°ºåº¦å—åŒæ–¹ç­¹ç é™åˆ¶
- **åŠ¨æ€é‡‡æ ·**ï¼šæ—©æœŸå¤šæ¢ç´¢ï¼ŒåæœŸåŠ é€Ÿæ”¶æ•›
- **æ—¥å¿—**ï¼šå…³é”®æ­¥éª¤æ·»åŠ  `print()` æ—¥å¿—ï¼Œæ ¼å¼ä¸º `[æ¨¡å—å] ä¿¡æ¯`

### å‚æ•°è°ƒæ•´ä½ç½®
| å‚æ•° | æ–‡ä»¶ | å˜é‡ |
|---|---|---|
| Card Abstraction | `solver/core/game_tree.py` | `_create_card_buckets()` |
| Effective Stack | `solver/core/game_tree.py` | `_get_available_actions()` |
| Max Raises | `solver/core/game_tree.py` | `__init__()` ä¸­çš„ `self.max_raises` |
| CFR é‡‡æ ·æ•° | `solver/core/cfr_engine.py` | `solve()` ä¸­çš„ `base_sample` |
| Equity é‡‡æ ·æ•° | `solver/core/cfr_engine.py` | `_terminal_ev_hand()` ä¸­çš„ `max_samples` |

### è°ƒè¯•æŠ€å·§
- ç»ˆç«¯ä¼šæ˜¾ç¤º `[GameTree]` å’Œ `[CFR]` å‰ç¼€çš„æ—¥å¿—
- å¦‚æœ solverå¡ä½ï¼Œæ£€æŸ¥æ ‘çš„èŠ‚ç‚¹æ•°ï¼ˆåº”è¯¥åœ¨å‡ åƒä»¥å†…ï¼‰
- è¿­ä»£æ¬¡æ•°å»ºè®® 50-200 æ¬¡ï¼ˆå¤ªå¤šä¼šå¾ˆæ…¢ï¼‰

## C++ Solver ç¼–è¯‘ä¸å¼€å‘è§„èŒƒ

### ç›®å½•ç»“æ„
```
solver/native/
â”œâ”€â”€ CMakeLists.txt      # CMake æ„å»ºé…ç½®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ cfr_engine.cpp
â”‚   â”œâ”€â”€ game_tree_builder.cpp
â”‚   â””â”€â”€ hand_evaluator.cpp
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ types.h
â”‚   â”œâ”€â”€ mmap_buffer.h
â”‚   â””â”€â”€ ...
â””â”€â”€ bindings.cpp        # pybind11 ç»‘å®š
```

### ç¼–è¯‘æµç¨‹ (Compilation Knowledge)
1. **ç¯å¢ƒå‡†å¤‡**ï¼šç¡®ä¿å·²å®‰è£… CMake (3.14+) å’Œæ”¯æŒ C++17 çš„ç¼–è¯‘å™¨ã€‚
2. **æ„å»ºæ­¥éª¤**ï¼š
   ```bash
   cd solver/native
   mkdir -p build
   cd build
   cmake ..
   make -j
   ```
3. **äº§ç‰©ç®¡ç†**ï¼šç¼–è¯‘ç”Ÿæˆçš„ `.so` (Linux/macOS) æˆ– `.pyd` (Windows) æ–‡ä»¶åº”ç§»åŠ¨æˆ–é“¾æ¥åˆ° `solver/` æ ¹ç›®å½•ä¸‹ï¼Œä»¥ä¾¿ Python æ¡¥æ¥å±‚ `solver/bridge/cpp_cfr_wrapper.py` åŠ è½½ã€‚

### ç¼–è¯‘è¦æ±‚
- C++17 æˆ–æ›´é«˜
- pybind11 (é€šå¸¸é€šè¿‡ CMake è‡ªåŠ¨æŸ¥æ‰¾)
- å†…å­˜æ˜ å°„æ”¯æŒ (MmapBuffer è¦æ±‚ç³»ç»Ÿæ”¯æŒ mmap)

### ä»£ç è§„èŒƒ
- ä½¿ç”¨ `snake_case` å‘½åï¼ˆä¸ Python ä¿æŒä¸€è‡´ï¼‰
- æ ¸å¿ƒæ•°æ®ç»“æ„ä½¿ç”¨ `struct`
- æ€§èƒ½å…³é”®è·¯å¾„é¿å…åŠ¨æ€å†…å­˜åˆ†é…
- ä½¿ç”¨ `std::vector` æˆ– `MmapBuffer` å­˜å‚¨å¤§æ•°æ®ï¼Œé¿å…é¢‘ç¹åˆ†é…
